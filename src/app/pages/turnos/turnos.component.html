<div class="container-fluid">
  <div class="row justify-content-center" >
    <div class="col-12">
      <div class="card shadow-lg">
        <div class="card-header bg-dark text-white">
          <h2 class="mb-0 text-center">Tabla de turnos:</h2>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th scope="col">Paciente</th>
                  <th scope="col">Especialista</th>
                  <th scope="col">Tipo</th>
                  <th scope="col">Fecha</th>
                  <th scope="col">Estado</th>
                  <th scope="col">Acciones</th>
                </tr>
              </thead>
              <tbody>
                @if(loading) {
                  <tr>
                    <td colspan="11" class="text-center">Cargando turnos...</td>
                  </tr>
                } @else { @for (turno of turnos; track $index) {
                  <tr>
                    <td>{{ turno.pacienteNombreCompleto }}</td>
                    <td>{{ turno.especialistaNombreCompleto }}</td>
                    <td>{{ turno.especialidad }}</td>
                    <td>{{ turno.hora | date: 'dd/MM - HH:mm' }}</td>
                    <td>
                      <span class="badge rounded-pill " [ngClass]="{'text-bg-danger': turno.estado == 'cancelado', 'text-bg-secondary': turno.estado == 'pendiente', 'text-bg-primary': turno.estado == 'aceptado', 'text-bg-success': turno.estado == 'realizado', 'text-bg-warning': turno.estado == 'rechazado'}">{{ turno.estado }} </span>
                    </td>
                    @if(turno.estado == 'pendiente')
                    {
                      <td>
                        <button
                          type="button"
                          class="btn btn-danger"
                          (click)="openModalCancelar(turno)">
                          Cancelar
                        </button>
                      </td>
                    }
                    @else if (turno.estado == 'cancelado'){
                      <td>
                        <button
                          type="button"
                          class="btn btn-info"
                          (click)="openModalMotivo(turno)">
                          Motivo
                        </button>
                      </td>
                    }
                  </tr>
                } @empty {
                <tr>
                  <td colspan="11" class="text-center">¡No hay turnos!</td>
                </tr>
                } }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@if(showModalCancelar)
{
  <div class="modal fade show" id="myModal" style="display: block; background-color: rgba(0, 0, 0, 0.5);" aria-labelledby="cancelarTurnoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="cancelarTurnoLabel">Ingrese comentario sobre el motivo de la cancelación</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="closeModalCancelar()"></button>
        </div>
        <div class="modal-body">
          <textarea class="form-control" id="message-text" [(ngModel)]="comentarioCancelacion"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closeModalCancelar()">Cerrar</button>
          <button type="button" class="btn btn-danger" (click)="cancelarTurno()">Cancelar turno</button>
        </div>
      </div>
    </div>
  </div>
}

@if(showModalMotivo)
{
  <div class="modal fade show" id="myModalMotivo" style="display: block; background-color: rgba(0, 0, 0, 0.5);" aria-labelledby="cancelarTurnoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="cancelarTurnoLabel">Motivo de la cancelación</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="closeModalMotivo()"></button>
        </div>
        <div class="modal-body">
          {{turnoSeleccionado?.comentario}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal" (click)="closeModalMotivo()">Ok</button>
        </div>
      </div>
    </div>
  </div>
}

